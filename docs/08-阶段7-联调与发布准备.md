# 阶段 7：联调、文档与发布准备（M7）

## 1. 阶段目标与范围

- **目标**：完成从「配置任务」到「名单生成」到「发私信」的端到端联调，更新方案文档与 README，定稿风险与合规说明，规划后续迭代路线图。
- **范围**：联调测试、文档更新、合规定稿、后续迭代规划；可选：打包发布。不新增业务功能。
- **前置依赖**：M0～M6 均已完成。

## 2. 里程碑明细

| 编号 | 里程碑 | 交付物/验收 | 细化说明 |
|------|--------|------------|----------|
| M7.1 | 端到端联调 | 全流程在真实环境跑通 | 使用真实抖音账号（建议小号）：创建任务 → 配置关键词与规则 → 启动采集 → 等待完成 → 执行筛选 → 审核名单 → 发送私信（建议先人工确认模式）。全程无阻塞性错误；数据在 DB 与界面一致。 |
| M7.2 | 异常场景测试 | 覆盖主要异常路径 | 测试：session 过期检测、风控预警触发与暂停、任务中断续跑、发送失败记录、日/任务上限触发停止。 |
| M7.3 | 文档更新 | README + 方案文档与实现对齐 | 根据实际实现更新：最终技术栈、目录结构、配置项列表与示例、API 接口变更记录。README：环境要求、安装步骤、首次运行（含登录与配置）、常见问题。 |
| M7.4 | 风险与合规定稿 | 独立文档或 README 章节 | 内容：抖音平台使用规范与违规风险；账号封禁与限流风险；用户隐私与数据留存建议（不长期保存敏感信息、定期清理）；建议用法（控制频率、人工复核、勿用于骚扰）。 |
| M7.5 | 发布与打包（可选） | 本地可执行包 | 若打包：pywebview + Vue 构建产物打成单目录或安装器。确保 .env、cookies、API Key 不被打包。说明用户需安装 Chromium（或 Playwright 依赖）。 |

## 3. 技术要点与实现建议

### 3.1 联调环境

- 使用抖音 PC 网页版真实环境。
- 建议使用测试小号，避免主号限流或封禁。
- 联调时将风控参数设为保守值（长间隔、低上限）。

### 3.2 联调检查清单

- [ ] 首次登录（扫码）→ Cookie 保存 → 重启后自动登录
- [ ] 创建任务 → 配置关键词"测试" → 启动采集 → 至少采集 10 条评论
- [ ] 执行筛选（配置一条白名单规则）→ 名单中仅含匹配用户
- [ ] 人工确认模式：勾选 1-2 名用户 → 确认发送 → 发送成功
- [ ] 全自动模式：启动发送 → 自动发送 → 间隔与上限生效
- [ ] 中断采集 → 重启 → 断点续跑（不重复已采集内容）
- [ ] 导出名单 CSV → 文件内容正确
- [ ] 风控预警：快速连续操作触发预警 → 自动暂停

### 3.3 文档位置

- 方案文档：`docs/00-总览与索引.md` 及 01～08 阶段文档
- README：项目根目录
- 合规说明：`docs/10-风险与合规.md` 或 README 的「免责与合规」章节
- 项目经验：`docs/09-项目经验与关键信息.md`

## 4. 后续迭代路线图

MVP 完成后可进入迭代维护。以下按优先级排列：

### 4.1 短期迭代（1-2 周）

| 功能 | 说明 |
|------|------|
| 楼中楼评论 | M2 扩展：展开并解析子评论，增加评论覆盖面 |
| 用户信息补全 | 自动从用户主页补全粉丝数/简介，增强筛选维度 |
| 多模板支持 | 支持一个任务关联多个模板，轮换或随机分配 |

### 4.2 中期迭代（2-4 周）

| 功能 | 说明 |
|------|------|
| 云端 AI 筛选 | 实现 `CloudAIProvider`，对接国内大模型 API |
| 回复监控 | 定期检查私信列表，检测目标用户是否回复/关注 |
| 转化统计 | 按关键词/模板维度统计触达率、回复率 |
| 定时任务 | 支持"每天 X 点自动搜索关键词并采集" |

### 4.3 远期规划

| 功能 | 说明 |
|------|------|
| 多账号管理 | 账号池、轮换策略、独立 Cookie 管理 |
| 代理/IP 轮换 | Playwright proxy 配置，应对限流 |
| 打包发布 | PyInstaller 或自定义安装器，面向非技术用户 |
| 数据看板 | 可视化统计：漏斗图、趋势图、热词分析 |

## 5. 验收标准

- [ ] 端到端流程在真实环境下完整跑通，且结果可核查（DB 与界面一致）。
- [ ] 异常场景（session 过期、风控、中断续跑）均有合理处理。
- [ ] 新用户能仅凭 README 完成安装、配置与一次完整运行。
- [ ] 风险与合规说明已定稿。

## 6. 产出物清单

- 联调测试记录与修复的 bug。
- 更新后的 `docs/` 与 README。
- 风险与合规定稿文档。
- 后续迭代路线图（本文档 §4）。
- 可执行包或安装器（可选）。
