# 阶段 5：桌面 GUI（M5）

## 1. 阶段目标与范围

- **目标**：提供本地桌面图形界面，完成任务配置、采集控制与进度展示、待触达名单审核与确认发送、发送与历史查看、以及登录与 API 等设置，使非命令行用户也能完成全流程操作。
- **范围**：GUI 技术选型与主框架、各功能界面与后端调用；业务逻辑仍由 M1～M4 模块提供，GUI 只做展示与调用。
- **前置依赖**：M2（任务与数据）、M3（名单）、M4（发送）核心能力已就绪；可先做「配置 + 名单审核」再补「采集控制 + 发送与历史」。

## 2. 里程碑明细

| 编号 | 里程碑 | 交付物/验收 | 细化说明 |
|------|--------|------------|----------|
| M5.1 | GUI 技术选型与骨架 | 选定 PyQt 或 Electron + 本地后端；主窗口、导航或 Tab 结构 | PyQt：与 Python 一体化，适合本地逻辑为主。Electron：前端技术栈统一，需本地起一个 Python 后端服务供前端调用。选定后建立主窗口、顶部或侧边导航（或 Tab）：任务、采集、名单、发送/历史、设置。 |
| M5.2 | 任务配置界面 | 关键词录入、评论条数/楼中楼开关、规则与 AI 开关、私信模板与风控参数 | 表单：任务名称、关键词列表（多行或标签）、每视频评论条数、是否含楼中楼、规则白黑名单与正则、是否启用 AI、私信模板正文、发送间隔与日/任务上限、全自动/人工确认。保存后写入 DB 或配置文件，供 M2/M3/M4 读取。 |
| M5.3 | 采集控制与进度 | 启动/暂停/停止采集；当前任务与进度展示；简单日志流 | 列表展示任务及状态；可选中任务后「开始采集」「暂停」「停止」。进度：当前关键词、当前视频序号、已采集评论数等（由 M2 流水线提供状态）。日志区实时追加采集日志（或最近 N 条）。 |
| M5.4 | 名单审核界面 | 待触达列表展示（昵称、评论、来源）；勾选/全选；人工确认后触发发送 | 表格或列表：昵称、评论内容、来源视频、是否已勾选。支持全选/反选/单条勾选。当任务为「人工确认」时，「确认发送」仅对已勾选用户调用 M4 发送接口；若为全自动则本页可仅展示名单与发送状态。 |
| M5.5 | 发送与历史 | 发送队列状态、成功/失败统计；历史发送记录查询 | 当前任务或全局：待发数、已发数、成功数、失败数。历史记录表：时间、用户、任务、成功/失败、失败原因；支持按任务、时间筛选。 |
| M5.6 | 设置与账号 | 登录入口、Cookie/账号状态；AI API 配置；全局限速与上限默认值 | 账号：触发「打开浏览器登录」或「加载 Cookie」；展示当前是否已登录（如通过请求用户信息校验）。AI：API Key、端点、模型名（可掩码显示）。全局默认：发送间隔、日上限等，作为任务配置的默认值。 |

## 3. 技术要点与实现建议

- **前后端分离（若 Electron）**：Python 以 HTTP 或 WebSocket 提供接口，Electron 内嵌页面调用；需约定 API 列表（任务 CRUD、启动/暂停采集、获取名单、确认发送、获取日志与统计等）。
- **与 M2 的协作**：采集流水线建议在独立线程或进程中运行，避免阻塞 UI；通过回调或队列将进度与日志推送到 GUI。
- **敏感信息**：API Key、Cookie 不打印到日志；设置页密钥输入框使用密码类型。

## 4. 验收标准

- [ ] 能通过 GUI 创建/编辑任务并保存；能启动采集并在界面看到进度与日志。
- [ ] 名单审核页能展示待触达列表，人工确认模式下勾选后点击「确认发送」能触发 M4 并更新发送状态。
- [ ] 设置页能配置登录与 AI，且密钥不以明文出现在日志中。

## 5. 产出物清单

- GUI 主工程（PyQt 或 Electron）；主窗口与导航结构。
- 任务配置页、采集控制与进度页、名单审核页、发送与历史页、设置页。
- 与 M2/M3/M4 的接口调用封装；进度与日志的订阅/轮询逻辑。

## 6. 与后续阶段的关系

- M6 将基于完整 GUI 与后端做端到端联调；M5 的配置与展示内容需与 M2/M3/M4 的数据模型一致，便于 M6 文档与打包。
