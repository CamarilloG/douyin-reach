# 阶段 0：环境与文档（M0）

## 1. 阶段目标与范围

- **目标**：统一开发环境、确认技术栈、产出落地方案文档骨架、约定项目目录与仓库规范，为后续开发提供可复现环境与文档基线。
- **范围**：不涉及业务代码实现，仅环境、文档与仓库结构。
- **前置依赖**：无。

## 2. 里程碑明细

| 编号 | 里程碑 | 交付物/验收 | 细化说明 |
|------|--------|------------|----------|
| M0.1 | 开发环境统一 | 文档：Python 版本、Node 版本、依赖管理方式 | Python 3.10+（兼容 Playwright、pywebview）；Node 18+（Vue 前端构建）；后端依赖：venv + requirements.txt；前端依赖：npm + package.json。文档中写明各版本要求与安装命令。 |
| M0.2 | 技术栈确认 | 关键决策写入文档并锁定 | 确认并写入：Playwright（浏览器自动化）、SQLite（存储）、pywebview + Vue 3（桌面 GUI）、关键词/正则筛选（MVP）、DOM 自动化发私信。写入 00-总览的关键决策表。 |
| M0.3 | 落地方案文档初版 | 完成 01～08 阶段文档骨架 | 对应文档结构中各阶段文档，每章至少为"标题 + 要点列表"形式；关键决策、MVP 范围、核心约束（陌生人一条消息）必须写清。 |
| M0.4 | 项目目录与仓库规范 | 目录结构、README、.gitignore | 建立目录：`docs/`、`src/backend/`、`src/frontend/`、`config/`、`data/`（.gitignore）。README 含项目简介、环境要求、安装步骤（占位）。.gitignore 含 venv、node_modules、__pycache__、.env、data/*.db、cookies 等。 |

## 3. 技术要点与实现建议

### 3.1 技术栈总览

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 浏览器自动化 | Playwright（Python 异步） | 反检测能力强、异步支持好、storageState 可持久化 Cookie |
| 数据存储 | SQLite | 单机足够；后续如需多进程可考虑 PostgreSQL |
| 规则引擎 | Python 内置 re + 字符串匹配 | 简单高效，MVP 够用 |
| AI 筛选 | 预留接口，MVP 不实现 | 后续对接云端大模型 API |
| 桌面 GUI | pywebview + Vue 3 | pywebview 提供轻量原生窗口壳，Vue 负责前端渲染 |
| 前后端通信 | pywebview JS-Python bridge | `window.pywebview.api` 调用后端 Python 方法 |
| 私信发送 | DOM 自动化 | 在私信叠层中操作输入框，不逆向 protobuf 接口 |

### 3.2 环境要求

- **Python**：3.10+，使用 `venv + requirements.txt`
- **Node.js**：18+，仅用于 Vue 前端构建（`npm install` / `npm run build`）
- **浏览器**：Playwright 自带 Chromium（`playwright install chromium`）
- **操作系统**：Windows 10+（主要目标），兼顾 macOS

### 3.3 前后端协作约定

pywebview 的 JS-Python bridge 是前后端通信的唯一通道。约定：

- 后端暴露一个 `Api` 类，所有方法均为前端可调用的接口
- 方法签名、入参、返回值在 M1 阶段（GUI 原型）中统一定义
- 前端通过 `window.pywebview.api.method_name(args)` 调用后端
- 长时任务（如采集）通过后端推送事件（pywebview `evaluate_js` 回调前端）实现进度更新

## 4. 验收标准

- [ ] 新成员按文档能在本地创建 Python 环境并安装后端依赖；创建 Node 环境并构建前端。
- [ ] 方案文档 01～08 均有对应内容，关键决策与 MVP 范围可追溯。
- [ ] 项目根目录结构清晰，README 与 .gitignore 已就绪，无敏感信息被纳入版本库。

## 5. 产出物清单

- 环境与依赖说明（README 或 `docs/环境与依赖.md`）。
- 落地方案文档初版（阶段文档骨架 + 关键决策 + MVP 定义）。
- 项目目录结构、README、.gitignore。
- requirements.txt（含 playwright、pywebview 等基础依赖）。
- package.json（Vue 3 前端项目初始化）。

## 6. 与后续阶段的关系

- M0 完成后可 **并行启动** M1（GUI 原型）与 M2（浏览器自动化），两者无直接依赖。
- M1 的 API 契约定义会反向约束 M2～M5 的接口设计，因此 M1 应尽早产出 API 接口清单。
